webpackJsonp([34],{240:function(t,e,n){"use strict";function i(t){l||n(875)}Object.defineProperty(e,"__esModule",{value:!0});var o=n(771),a=n.n(o);for(var r in o)"default"!==r&&function(t){n.d(e,t,function(){return o[t]})}(r);var s=n(877),d=n.n(s),l=!1,c=n(0),p=i,u=c(a.a,d.a,!1,p,null,null);u.options.__file="src/views/course/chapter-edit.vue",e.default=u.exports},771:function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(55),a=i(o),r=n(86),s=i(r),d=n(6),l=i(d);e.default={name:"chapter_edit",data:function(){var t=this;return{id:0,chapter_title:"",section_title:"",newName:"",center_id:0,modal1:!1,video_id:0,up_way:0,section:{id:0,chapter_id:"",section_title:"",is_save:1,video_main:"",video_backup:"",video_time:""},upload_data:{},videoList:{},vList:[],video_url:"",video_time:0,data:[{title:"课程",expand:!0,render:function(e,n){var i=(n.root,n.node,n.data),o=t;return e("span",{style:{display:"inline-block",width:"100%"}},[e("span",[e("Icon",{props:{type:"merge"},style:{marginRight:"8px"}}),e("span",i.title)]),e("span",{style:{display:"inline-block",float:"right",marginRight:"32px"}},[e("Button",{props:(0,a.default)({},t.buttonProps,{icon:"ios-plus-empty",type:"primary"}),on:{click:function(){o.addChapter(i)}},attrs:{title:"添加章节"}})])])},children:[]}],buttonProps:{type:"ghost",size:"small"}}},methods:{getVideo:function(){var t=this;this.request({api:"/v1/video/getVideoList",center_id:this.center_id},function(e){1===e.status?(t.vList=e.data,t.videoList=t.array_map(e.data,"id","title")):this.$Message.error("获取视频信息失败")})},changeUrl:function(t){for(var e=0;e<this.vList.length;e++)this.vList[e].id.toString()===t&&(this.video_url=this.vList[e].url,this.video_time=this.vList[e].video_time)},ok:function(){this.section.video_main=this.video_url,this.section.video_time=this.video_time},cancel:function(){window.close()},saveData:function(){var t=this;this.editSection(this.section,function(e){1===e.status?(t.section.is_save=1,t.$Message.success("保存成功")):t.$Message.error(e.msg)})},editSection:function(t,e){t.api="/v1/course/edit_section",t.user_type=3,this.request(t,e)},getCatalog:function(){var t=this;this.request({api:"/v1/course/catalog",id:this.id},function(e){var n=e.data;for(var i in n){n[i].render=function(e,n){var i=n.root,o=n.node,a=n.data;return t.renderContent(e,{root:i,node:o,data:a},1)},n[i].level=1;for(var o in n[i].children)n[i].children[o].render=function(e,n){var i=n.root,o=n.node,a=n.data;return t.renderContent(e,{root:i,node:o,data:a},2)},n[i].children[o].level=2}t.data[0].children=n})},getSection:function(t){var e=this;this.request({api:"/v1/course/read_section",id:t,user_type:3},function(t){t.status?e.section={is_save:1,id:t.data.id,chapter_id:t.data.chapter_id,section_title:t.data.section_title,video_main:t.data.video_main,video_time:t.data.video_time}:e.$Message.error("获取课时信息失败")})},doAddChapter:function(t,e){this.request({api:"/v1/course/add_chapter",id:this.id,chapter_title:t,user_type:3},e)},doAddSection:function(t,e,n){this.request({api:"/v1/course/add_section",id:this.id,chapter_id:t,section_title:e,user_type:3},n)},del:function(t,e){var n=0,i=[];1===t.level?(n=t.id,void 0!==t.children&&(i=t.children.map(function(t){return t.id})),this.request({api:"/v1/course/del_chapter",id:this.id,chapter_id:n,user_type:3},e),this.request({api:"/v1/course/del_section",ids:i,chapter_id:n,user_type:3})):(i=[t.id],this.request({api:"/v1/course/del_section",ids:i,chapter_id:n,user_type:3},e))},addChapter:function(t){var e=this;this.$Modal.confirm({title:"填写章节名称",render:function(t){return t("Input",{props:{placeholder:"请输入章节名称",autofocus:!0,value:e.chapter_title},style:{marginTop:"20px"},on:{input:function(t){e.chapter_title=t}}})},onOk:function(){""===e.chapter_title?e.$Message.error("章节名称必须"):e.doAddChapter(e.chapter_title,function(n){1===n.status?(e.append(n.data.id,e.chapter_title,t,1),e.chapter_title=""):e.$Message.error(n.msg)})}})},addSection:function(t){var e=this;this.$Modal.confirm({title:"填写课时名称",render:function(t){return t("Input",{props:{placeholder:"请输入课时名称",autofocus:!0,value:e.section_title},style:{marginTop:"20px"},on:{input:function(t){e.section_title=t}}})},onOk:function(){""===e.section_title?e.$Message.error("课时名称必须"):e.doAddSection(t.id,e.section_title,function(n){1===n.status?(e.append(n.data.id,e.section_title,t,2),e.section_title="",e.getSection(n.data.id)):e.$Message.error(n.msg)})}})},rename:function(t){var e=this;this.$Modal.confirm({title:"重命名",render:function(t){return t("Input",{props:{placeholder:"请输入课时名称",autofocus:!0,value:e.section_title},style:{marginTop:"20px"},on:{input:function(t){e.newName=t}}})},onOk:function(){""===e.newName?e.$Message.error("请填写名称"):1===t.level?e.request({api:"/v1/course/edit_chapter",user_type:3,chapter_title:e.newName,chapter_id:t.id},function(t){1===t.status?(e.$Message.success("重命名成功"),e.getCatalog()):e.$Message.error(t.msg)}):e.editSection({id:t.id,section_title:e.newName},function(t){1===t.status?(e.$Message.success("重命名成功"),e.getCatalog()):e.$Message.error(t.msg)})}})},renderContent:function(t,e,n){var i=this,o=e.root,r=e.node,d=e.data,l=this,c=[t("Button",{props:(0,a.default)({},this.buttonProps,{icon:"ios-plus-empty",type:"primary"}),style:{marginRight:"8px"},attrs:{title:"添加课时"},on:{click:function(){1===l.section.is_save?l.addSection(d):l.$Message.error("请先保存当前课时信息，再操作")}}}),t("Button",{props:(0,a.default)({},this.buttonProps,{icon:"edit",type:"primary",size:"small"}),style:{marginRight:"8px",width:"22px",textIndent:"-1px"},attrs:{title:"重命名"},on:{click:function(){0===l.section.is_save&&l.section.id!==d.id?l.$Message.error("请先保存当前课时信息，再操作"):l.rename(d)}}}),t("Button",{props:(0,a.default)({},this.buttonProps,{icon:"ios-minus-empty",type:"error"}),attrs:{title:"删除"},on:{click:function(){i.remove(o,r,d)}}})],p="ios-folder-outline",u="default";return 1!==n&&(c.splice(0,1),p="ios-paper-outline",u="pointer"),t("span",{style:{display:"inline-block",width:"100%"}},[t("span",{style:{padding:"3px",borderRadius:"3px",cursor:u},attrs:{class:"section_title"},on:{click:function(t){2===n&&(0===l.section.is_save&&l.section.id!==d.id?l.$Message.error("请先保存当前课时信息，再操作"):(l.getSection(d.id),(0,s.default)(".section_title").removeClass("section-active"),(0,s.default)(t.target).hasClass("section_title")?(0,s.default)(t.target).addClass("section-active"):(0,s.default)(t.target).parent().addClass("section-active")))}}},[t("Icon",{props:{type:p},style:{marginRight:"8px"}}),t("span",d.title)]),t("span",{style:{display:"inline-block",float:"right",marginRight:"32px"}},c)])},append:function(t,e,n,i){var o=n.children||[],a=this;o.push({title:e,id:t,level:i,expand:!0,render:function(t,e){var n=e.root,o=e.node,r=e.data;return a.renderContent(t,{root:n,node:o,data:r},i)}}),this.$set(n,"children",o)},remove:function(t,e,n){var i=t.find(function(t){return t===e}).parent,o=t.find(function(t){return t.nodeKey===i}).node,a=o.children.indexOf(n),r=this;this.del(o.children[a],function(t){1===t.status?o.children.splice(a,1):r.$Message.error(t.msg)})}},mounted:function(){this.center_id=l.default.get("center_id"),this.id=this.$route.params.course_id,this.getCatalog(),this.getVideo()}}},875:function(t,e,n){var i=n(876);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);n(10)("771f57f9",i,!1,{})},876:function(t,e,n){e=t.exports=n(9)(!1),e.push([t.i,"\n.margin-top-8 {\n  margin-top: 8px;\n}\n.margin-top-10 {\n  margin-top: 10px;\n}\n.margin-top-20 {\n  margin-top: 20px;\n}\n.margin-left-10 {\n  margin-left: 10px;\n}\n.margin-bottom-10 {\n  margin-bottom: 10px;\n}\n.margin-bottom-100 {\n  margin-bottom: 100px;\n}\n.margin-right-10 {\n  margin-right: 10px;\n}\n.padding-left-6 {\n  padding-left: 6px;\n}\n.padding-left-8 {\n  padding-left: 5px;\n}\n.padding-left-10 {\n  padding-left: 10px;\n}\n.padding-left-20 {\n  padding-left: 20px;\n}\n.height-100 {\n  height: 100%;\n}\n.height-120px {\n  height: 100px;\n}\n.height-200px {\n  height: 200px;\n}\n.height-492px {\n  height: 492px;\n}\n.height-460px {\n  height: 460px;\n}\n.line-gray {\n  height: 0;\n  border-bottom: 2px solid #dcdcdc;\n}\n.notwrap {\n  word-break: keep-all;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.padding-left-5 {\n  padding-left: 10px;\n}\n[v-cloak] {\n  display: none;\n}\n.article-link-con {\n  height: 32px;\n  width: 100%;\n}\n.fixed-link-enter {\n  opacity: 0;\n}\n#header .ivu-card-body {\n  padding: 0;\n}\n.fixed-link-enter-active,\n.fixed-link-leave-active {\n  transition: opacity 0.3s;\n}\n.fixed-link-enter-to {\n  opacity: 1;\n}\n.openness-radio-con {\n  margin-left: 40px;\n  padding-left: 10px;\n  height: 130px;\n  border-left: 1px dashed #ebe9f3;\n  overflow: hidden;\n}\n.publish-time-picker-con {\n  margin-left: 40px;\n  padding-left: 10px;\n  height: 100px;\n  border-left: 1px dashed #ebe9f3;\n  overflow: hidden;\n}\n.openness-con-enter {\n  height: 0;\n}\n.openness-con-enter-active,\n.openness-con-leave-active {\n  transition: height .3s;\n}\n.openness-con-enter-to {\n  height: 130px;\n}\n.openness-con-leave {\n  height: 130px;\n}\n.openness-con-leave-to {\n  height: 0;\n}\n.publish-button-con {\n  border-top: 1px solid #f3eff1;\n  padding-top: 14px;\n}\n.publish-button {\n  float: right;\n  margin-left: 10px;\n}\n.publish-time-enter {\n  height: 0;\n}\n.publish-time-enter-active,\n.publish-time-leave-active {\n  transition: height .3s;\n}\n.publish-time-enter-to {\n  height: 100px;\n}\n.publish-time-leave {\n  height: 100px;\n}\n.publish-time-leave-to {\n  height: 0;\n}\n.classification-con {\n  height: 200px;\n  margin-top: -16px;\n  border-left: 1px solid #dddee1;\n  border-right: 1px solid #dddee1;\n  border-bottom: 1px solid #dddee1;\n  border-radius: 0 0 3px 3px;\n  padding: 10px;\n  overflow: auto;\n}\n.add-new-tag-con {\n  margin-top: 20px;\n  border-top: 1px dashed #dbdddf;\n  padding: 20px 0;\n  height: 60px;\n  overflow: hidden;\n}\n.add-new-tag-enter {\n  height: 0;\n  margin-top: 0;\n  padding: 0px 0;\n}\n.add-new-tag-enter-active,\n.add-new-tag-leave-active {\n  transition: all .3s;\n}\n.add-new-tag-enter-to {\n  height: 60px;\n  margin-top: 20px;\n  padding: 20px 0;\n}\n.add-new-tag-leave {\n  height: 60px;\n  margin-top: 20px;\n  padding: 20px 0;\n}\n.add-new-tag-leave-to {\n  height: 0;\n  margin-top: 0;\n  padding: 0px 0;\n}\n.section-active {\n  background-color: #e2e2e2;\n}\n",""])},877:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Row",[n("Card",{attrs:{id:"header"}},[n("div",{attrs:{slot:"title"},slot:"title"},[n("p",{staticStyle:{width:"auto"}},[n("Icon",{attrs:{type:"pound"}}),t._v("\n                    章节管理\n                ")],1),t._v(" "),n("p",{staticStyle:{width:"auto",float:"right",height:"25px"}},[n("Button",{attrs:{type:"primary",size:"small"},on:{click:t.handleBack}},[t._v("返回课程编辑")])],1),t._v(" "),n("div",{staticStyle:{clear:"both"}})])])],1),t._v(" "),n("Row",{staticStyle:{"background-color":"#fff"}},[n("Col",{attrs:{span:"6"}},[n("Card",[n("p",{attrs:{slot:"title"},slot:"title"},[n("Icon",{attrs:{type:"android-menu"}}),t._v("\n                    章节目录\n                ")],1),t._v(" "),n("Tree",{attrs:{data:t.data}})],1)],1),t._v(" "),n("Col",{attrs:{span:"18"}},[n("Card",[n("p",{attrs:{slot:"title"},slot:"title"},[n("Icon",{attrs:{type:"android-create"}}),t._v("\n                    课时详情\n                ")],1),t._v(" "),n("Form",[n("FormItem",{attrs:{label:"课时名称:","label-width":100}},[n("Col",{attrs:{span:"19"}},[n("Input",{attrs:{disabled:""},on:{"on-change":t.handleDataChange},model:{value:t.section.section_title,callback:function(e){t.$set(t.section,"section_title",e)},expression:"section.section_title"}})],1)],1),t._v(" "),n("FormItem",{attrs:{label:"视频库视频:","label-width":100,id:"video_lib"}},[n("Col",{attrs:{span:"18"}},[n("Input",{attrs:{id:"video_main_url",value:""},model:{value:t.section.video_main,callback:function(e){t.$set(t.section,"video_main",e)},expression:"section.video_main"}})],1),t._v(" "),n("Col",{attrs:{span:"4"}},[n("Button",{on:{click:function(e){t.modal1=!0}}},[t._v("视频库视频")]),t._v(" "),n("Modal",{attrs:{title:"选择视频"},on:{"on-ok":t.ok,"on-cancel":t.cancel},model:{value:t.modal1,callback:function(e){t.modal1=e},expression:"modal1"}},[n("RadioGroup",{attrs:{vertical:""},on:{"on-change":t.changeUrl},model:{value:t.video_url,callback:function(e){t.video_url=e},expression:"video_url"}},t._l(t.videoList,function(e,i){return n("Radio",{key:i,attrs:{value:i,label:i}},[t._v(t._s(e))])}))],1)],1)],1),t._v(" "),n("FormItem",{attrs:{label:"视频时长:","label-width":100}},[n("Col",{attrs:{span:"19"}},[n("Input",{attrs:{id:"vTime"},model:{value:t.section.video_time,callback:function(e){t.$set(t.section,"video_time",e)},expression:"section.video_time"}})],1)],1),t._v(" "),n("div",{staticStyle:{"margin-top":"40px","text-align":"center"}},[n("Button",{attrs:{type:"text"},on:{click:function(e){t.getSection(t.section.id)}}},[t._v("重置")]),t._v(" "),n("Button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary"},on:{click:t.saveData}},[t._v("保存")])],1)],1)],1)],1)],1)],1)},o=[];i._withStripped=!0;var a={render:i,staticRenderFns:o};e.default=a}});